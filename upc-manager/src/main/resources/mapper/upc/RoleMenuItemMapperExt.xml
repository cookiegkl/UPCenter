<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.hanzhdy.manager.upc.mapper.RoleMenuItemMapperExt">
    <!-- 根据菜单项ID，删除与之关联的权限信息 -->
    <delete id="deleteByItemid" parameterType="java.lang.Long">
    DELETE FROM r_role_menuitem WHERE ITEMID=${itemid,jdbcType=NUMERIC}
    </delete>

    <!-- 根据角色ID和菜单ID，删除该角色关联的菜单项数据，并且这些菜单项数据隶属于输入的菜单ID -->
    <delete id="deleteByRoleAndMenuid" parameterType="java.util.HashMap">
    DELETE FROM r_role_menuitem WHERE roleid=#{roleid} AND itemid in (SELECT ID FROM r_menuitem WHERE menuid=#{menuid})
    </delete>

	<!-- 角色权限设置页面，根据角色和菜单ID，查询资源信息 -->
    <select id="selectForSettingRoleResource" parameterType="java.util.HashMap" resultType="org.hanzhdy.manager.upc.vo.Resource">
SELECT
	rmi.ID AS id,
	rmi.ITEMCODE AS code,
	rmi.ITEMNAME AS name,
	rmi.MENUID AS parentid,
	rmi.RESOURCE AS url,
	rmi.SORT AS sort,
	IF(r.ROLEID IS NOT NULL, 'true', 'false') AS checked
FROM
	(
		SELECT
			*
		FROM
			r_menuitem rmi
		WHERE
			rmi.MENUID = #{menuid}
		AND rmi. STATUS = 'N'
	) rmi
LEFT JOIN r_role_menuitem r ON (
	r.ROLEID = #{roleid}
	AND r.ITEMID = rmi.ID
)
ORDER BY rmi.SORT
    </select>
</mapper>